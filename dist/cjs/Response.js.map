{"version":3,"sources":["../../src/Response.ts"],"names":["ParseStatus","BodyHeaders","MultipartResponse","contentType","status","Body","lines","undefined","Error","headers","_parsingState","Headers","text","line","body","join","length","push","JSON","parse"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;;;;;;;;;;;IAGYA,W;;;WAAAA,W;AAAAA,EAAAA,W,CAAAA,W;AAAAA,EAAAA,W,CAAAA,W;GAAAA,W,2BAAAA,W;;IAUCC,W;;;;;mCAEc,E;;;;;;;;;;;IAMNC,iB;AAUnB,6BAAYC,WAAZ,EAAiC;AAAA;;AAAA;;AAAA,qCARV,IAQU;;AAAA,kCAPlB,IAOkB;;AAAA,2CALY;AAC3CC,MAAAA,MAAM,EAAEJ,WAAW,CAACK,IADuB;AAE3CC,MAAAA,KAAK,EAAE;AAFoC,KAKZ;;AAC/B,QAAIH,WAAW,KAAKI,SAApB,EAA+B,MAAM,IAAIC,KAAJ,CAAU,iCAAV,CAAN;AAC/B,SAAKL,WAAL,GAAmBA,WAAnB;;AACA,QAAI,KAAKA,WAAL,KAAqB,kBAAzB,EAA6C;AAC3C,WAAKM,OAAL,GAAe,IAAIR,WAAJ,EAAf;AACA,WAAKS,aAAL,CAAmBN,MAAnB,GAA4BJ,WAAW,CAACW,OAAxC;AACD;AACF;;;;WAED,gBAAgB;AACd,aAAO,CAAC,KAAKD,aAAb;AACD;;;WAED,eAAME,IAAN,EAA0B;AACxB,iCAAU,IAAV,EAAgBA,IAAhB;AACD;;;WAED,cAAKC,IAAL,EAAyB;AACvB,UAAI,CAAC,KAAKH,aAAV,EAAyB,MAAM,IAAIF,KAAJ,CAAU,0CAAV,CAAN;;AACzB,UAAIK,IAAI,KAAK,IAAb,EAAmB;AACjB,YAAI,KAAKH,aAAL,CAAmBN,MAAnB,KAA8BJ,WAAW,CAACK,IAA9C,EAAoD,MAAM,IAAIG,KAAJ,CAAU,0BAAV,CAAN;AACpD,aAAKM,IAAL,GAAY,KAAKJ,aAAL,CAAmBJ,KAAnB,CAAyBS,IAAzB,CAA8B,MAA9B,CAAZ;AACA,aAAKL,aAAL,GAAqB,IAArB;AACA;AACD;;AAED,UAAI,KAAKA,aAAL,CAAmBN,MAAnB,KAA8BJ,WAAW,CAACW,OAA9C,EAAuD;AACrD,YAAI,CAACE,IAAI,CAACG,MAAV,EAAkB,KAAKN,aAAL,CAAmBN,MAAnB,GAA4BJ,WAAW,CAACK,IAAxC,CAAlB,KACK,IAAI,CAAC,6BAAY,KAAKI,OAAjB,EAA0BI,IAA1B,CAAL,EAAsC,6BAAY,KAAKJ,OAAL,CAAaA,OAAzB,EAAkCI,IAAlC,EAAwC,GAAxC;AAC5C,OAHD,MAGO,IAAI,KAAKH,aAAL,CAAmBN,MAAnB,KAA8BJ,WAAW,CAACK,IAA9C,EAAoD;AACzD,YAAI,CAACQ,IAAI,CAACG,MAAV,EAAkB,KAAKC,IAAL,CAAU,IAAV,EAAlB,KACK,KAAKP,aAAL,CAAmBJ,KAAnB,CAAyBW,IAAzB,CAA8BJ,IAA9B;AACN;AACF;;;WAED,gBAAe;AACb,UAAI,KAAKH,aAAT,EAAwB,MAAM,IAAIF,KAAJ,CAAU,0CAAV,CAAN;AACxB,aAAO,KAAKM,IAAZ;AACD;;;WAED,gBAAgB;AACd,UAAI,KAAKJ,aAAT,EAAwB,MAAM,IAAIF,KAAJ,CAAU,0CAAV,CAAN;AACxB,aAAOU,IAAI,CAACC,KAAL,CAAW,KAAKL,IAAhB,CAAP;AACD","sourcesContent":["import parseHeader from \"./lib/parseHeader.js\";\nimport parseStatus from \"./lib/parseStatus.js\";\nimport parseText from \"./lib/parseText.js\";\nimport type { Version, HeadersObject } from \"./index.js\";\n\nexport enum ParseStatus {\n  Headers = 1,\n  Body,\n}\n\nexport interface ParsingState {\n  status: ParseStatus;\n  lines: string[];\n}\n\nexport class BodyHeaders {\n  version: Version;\n  headers: HeadersObject = {};\n  ok: boolean;\n  status: number;\n  statusText: string;\n}\n\nexport default class MultipartResponse {\n  contentType: string;\n  headers: BodyHeaders = null;\n  body: string = null;\n\n  private _parsingState: ParsingState | null = {\n    status: ParseStatus.Body,\n    lines: [],\n  };\n\n  constructor(contentType: string) {\n    if (contentType === undefined) throw new Error(\"Response missing a content type\");\n    this.contentType = contentType;\n    if (this.contentType === \"application/http\") {\n      this.headers = new BodyHeaders();\n      this._parsingState.status = ParseStatus.Headers;\n    }\n  }\n\n  done(): boolean {\n    return !this._parsingState;\n  }\n\n  parse(text: string): void {\n    parseText(this, text);\n  }\n\n  push(line: string): void {\n    if (!this._parsingState) throw new Error(\"Attempting to parse a completed response\");\n    if (line === null) {\n      if (this._parsingState.status !== ParseStatus.Body) throw new Error(\"Unexpected parsing state\");\n      this.body = this._parsingState.lines.join(\"\\r\\n\");\n      this._parsingState = null;\n      return;\n    }\n\n    if (this._parsingState.status === ParseStatus.Headers) {\n      if (!line.length) this._parsingState.status = ParseStatus.Body;\n      else if (!parseStatus(this.headers, line)) parseHeader(this.headers.headers, line, \":\");\n    } else if (this._parsingState.status === ParseStatus.Body) {\n      if (!line.length) this.push(null);\n      else this._parsingState.lines.push(line);\n    }\n  }\n\n  text(): string {\n    if (this._parsingState) throw new Error(\"Attempting to use an incomplete response\");\n    return this.body;\n  }\n\n  json(): unknown {\n    if (this._parsingState) throw new Error(\"Attempting to use an incomplete response\");\n    return JSON.parse(this.body);\n  }\n}\n"],"file":"Response.js"}