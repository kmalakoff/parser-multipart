{"version":3,"file":"Response.js","names":["ParseStatus","BodyHeaders","MultipartResponse","contentType","status","Body","lines","undefined","Error","headers","_parsingState","Headers","text","parseText","line","body","join","length","parseStatus","parseHeader","push","JSON","parse"],"sources":["../../src/Response.ts"],"sourcesContent":["import parseHeader from \"./lib/parseHeader\";\nimport parseStatus from \"./lib/parseStatus\";\nimport parseText from \"./lib/parseText\";\nimport type { Version, HeadersObject } from \"./index\";\n\nexport enum ParseStatus {\n  Headers = 1,\n  Body,\n}\n\nexport interface ParsingState {\n  status: ParseStatus;\n  lines: string[];\n}\n\nexport class BodyHeaders {\n  version: Version;\n  headers: HeadersObject = {};\n  ok: boolean;\n  status: number;\n  statusText: string;\n}\n\nexport default class MultipartResponse {\n  contentType: string;\n  headers: BodyHeaders = null;\n  body: string = null;\n\n  private _parsingState: ParsingState | null = {\n    status: ParseStatus.Body,\n    lines: [],\n  };\n\n  constructor(contentType: string) {\n    if (contentType === undefined) throw new Error(\"Response missing a content type\");\n    this.contentType = contentType;\n    if (this.contentType === \"application/http\") {\n      this.headers = new BodyHeaders();\n      this._parsingState.status = ParseStatus.Headers;\n    }\n  }\n\n  done(): boolean {\n    return !this._parsingState;\n  }\n\n  parse(text: string): void {\n    parseText(this, text);\n  }\n\n  push(line: string): void {\n    if (!this._parsingState) throw new Error(\"Attempting to parse a completed response\");\n    if (line === null) {\n      if (this._parsingState.status !== ParseStatus.Body) throw new Error(\"Unexpected parsing state\");\n      this.body = this._parsingState.lines.join(\"\\r\\n\");\n      this._parsingState = null;\n      return;\n    }\n\n    if (this._parsingState.status === ParseStatus.Headers) {\n      if (!line.length) this._parsingState.status = ParseStatus.Body;\n      else if (!parseStatus(this.headers, line)) parseHeader(this.headers.headers, line, \":\");\n    } else if (this._parsingState.status === ParseStatus.Body) {\n      if (!line.length) this.push(null);\n      else this._parsingState.lines.push(line);\n    }\n  }\n\n  text(): string {\n    if (this._parsingState) throw new Error(\"Attempting to use an incomplete response\");\n    return this.body;\n  }\n\n  json(): unknown {\n    if (this._parsingState) throw new Error(\"Attempting to use an incomplete response\");\n    return JSON.parse(this.body);\n  }\n}\n"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;;;;;;;;;;;IAGYA,W;;;WAAAA,W;EAAAA,W,CAAAA,W;EAAAA,W,CAAAA,W;GAAAA,W,2BAAAA,W;;IAUCC,W;;;;;mCAEc,E;;;;;;;;;;;IAMNC,iB;EAUnB,2BAAYC,WAAZ,EAAiC;IAAA;;IAAA;;IAAA,iCARV,IAQU;;IAAA,8BAPlB,IAOkB;;IAAA,uCALY;MAC3CC,MAAM,EAAEJ,WAAW,CAACK,IADuB;MAE3CC,KAAK,EAAE;IAFoC,CAKZ;;IAC/B,IAAIH,WAAW,KAAKI,SAApB,EAA+B,MAAM,IAAIC,KAAJ,CAAU,iCAAV,CAAN;IAC/B,KAAKL,WAAL,GAAmBA,WAAnB;;IACA,IAAI,KAAKA,WAAL,KAAqB,kBAAzB,EAA6C;MAC3C,KAAKM,OAAL,GAAe,IAAIR,WAAJ,EAAf;MACA,KAAKS,aAAL,CAAmBN,MAAnB,GAA4BJ,WAAW,CAACW,OAAxC;IACD;EACF;;;;WAED,gBAAgB;MACd,OAAO,CAAC,KAAKD,aAAb;IACD;;;WAED,eAAME,IAAN,EAA0B;MACxB,IAAAC,qBAAA,EAAU,IAAV,EAAgBD,IAAhB;IACD;;;WAED,cAAKE,IAAL,EAAyB;MACvB,IAAI,CAAC,KAAKJ,aAAV,EAAyB,MAAM,IAAIF,KAAJ,CAAU,0CAAV,CAAN;;MACzB,IAAIM,IAAI,KAAK,IAAb,EAAmB;QACjB,IAAI,KAAKJ,aAAL,CAAmBN,MAAnB,KAA8BJ,WAAW,CAACK,IAA9C,EAAoD,MAAM,IAAIG,KAAJ,CAAU,0BAAV,CAAN;QACpD,KAAKO,IAAL,GAAY,KAAKL,aAAL,CAAmBJ,KAAnB,CAAyBU,IAAzB,CAA8B,MAA9B,CAAZ;QACA,KAAKN,aAAL,GAAqB,IAArB;QACA;MACD;;MAED,IAAI,KAAKA,aAAL,CAAmBN,MAAnB,KAA8BJ,WAAW,CAACW,OAA9C,EAAuD;QACrD,IAAI,CAACG,IAAI,CAACG,MAAV,EAAkB,KAAKP,aAAL,CAAmBN,MAAnB,GAA4BJ,WAAW,CAACK,IAAxC,CAAlB,KACK,IAAI,CAAC,IAAAa,uBAAA,EAAY,KAAKT,OAAjB,EAA0BK,IAA1B,CAAL,EAAsC,IAAAK,uBAAA,EAAY,KAAKV,OAAL,CAAaA,OAAzB,EAAkCK,IAAlC,EAAwC,GAAxC;MAC5C,CAHD,MAGO,IAAI,KAAKJ,aAAL,CAAmBN,MAAnB,KAA8BJ,WAAW,CAACK,IAA9C,EAAoD;QACzD,IAAI,CAACS,IAAI,CAACG,MAAV,EAAkB,KAAKG,IAAL,CAAU,IAAV,EAAlB,KACK,KAAKV,aAAL,CAAmBJ,KAAnB,CAAyBc,IAAzB,CAA8BN,IAA9B;MACN;IACF;;;WAED,gBAAe;MACb,IAAI,KAAKJ,aAAT,EAAwB,MAAM,IAAIF,KAAJ,CAAU,0CAAV,CAAN;MACxB,OAAO,KAAKO,IAAZ;IACD;;;WAED,gBAAgB;MACd,IAAI,KAAKL,aAAT,EAAwB,MAAM,IAAIF,KAAJ,CAAU,0CAAV,CAAN;MACxB,OAAOa,IAAI,CAACC,KAAL,CAAW,KAAKP,IAAhB,CAAP;IACD"}