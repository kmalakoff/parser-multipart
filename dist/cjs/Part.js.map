{"version":3,"file":"Part.js","names":["ParseStatus","MultipartPart","status","Headers","_parsingState","text","parseText","line","Error","Response","response","done","push","length","headers","undefined","MultipartResponse","parseHeader"],"sources":["../../src/Part.ts"],"sourcesContent":["import parseHeader from \"./lib/parseHeader.js\";\nimport parseText from \"./lib/parseText.js\";\nimport MultipartResponse from \"./Response.js\";\nimport type { HeadersObject } from \"./index.js\";\n\nexport enum ParseStatus {\n  Headers = 1,\n  Response,\n}\n\nexport interface ParsingState {\n  status: ParseStatus;\n}\n\nexport default class MultipartPart {\n  headers: HeadersObject = {};\n  response: MultipartResponse | null;\n\n  private _parsingState: ParsingState | null = {\n    status: ParseStatus.Headers,\n  };\n\n  done(): boolean {\n    return !this._parsingState;\n  }\n\n  parse(text: string): void {\n    parseText(this, text);\n  }\n\n  push(line: string): void {\n    if (!this._parsingState) throw new Error(\"Attempting to parse a completed part\");\n    if (line === null) {\n      if (this._parsingState.status !== ParseStatus.Response) throw new Error(\"Unexpected parsing state\");\n      if (!this.response.done()) this.response.push(null);\n      this._parsingState = null;\n      return;\n    }\n\n    if (this._parsingState.status === ParseStatus.Headers) {\n      if (!line.length) {\n        if (this.headers[\"content-type\"] === undefined) throw new Error(\"Missing content type\");\n        this._parsingState.status = ParseStatus.Response;\n        this.response = new MultipartResponse(this.headers[\"content-type\"]);\n      } else parseHeader(this.headers, line, \":\");\n    } else if (this._parsingState.status === ParseStatus.Response) {\n      this.response.push(line);\n    }\n  }\n}\n"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;;;;;;;;;;;IAGYA,W;;;WAAAA,W;EAAAA,W,CAAAA,W;EAAAA,W,CAAAA,W;GAAAA,W,2BAAAA,W;;IASSC,a;;;;qCACM,E;;;;2CAGoB;MAC3CC,MAAM,EAAEF,WAAW,CAACG;IADuB,C;;;;;WAI7C,gBAAgB;MACd,OAAO,CAAC,KAAKC,aAAb;IACD;;;WAED,eAAMC,IAAN,EAA0B;MACxB,IAAAC,qBAAA,EAAU,IAAV,EAAgBD,IAAhB;IACD;;;WAED,cAAKE,IAAL,EAAyB;MACvB,IAAI,CAAC,KAAKH,aAAV,EAAyB,MAAM,IAAII,KAAJ,CAAU,sCAAV,CAAN;;MACzB,IAAID,IAAI,KAAK,IAAb,EAAmB;QACjB,IAAI,KAAKH,aAAL,CAAmBF,MAAnB,KAA8BF,WAAW,CAACS,QAA9C,EAAwD,MAAM,IAAID,KAAJ,CAAU,0BAAV,CAAN;QACxD,IAAI,CAAC,KAAKE,QAAL,CAAcC,IAAd,EAAL,EAA2B,KAAKD,QAAL,CAAcE,IAAd,CAAmB,IAAnB;QAC3B,KAAKR,aAAL,GAAqB,IAArB;QACA;MACD;;MAED,IAAI,KAAKA,aAAL,CAAmBF,MAAnB,KAA8BF,WAAW,CAACG,OAA9C,EAAuD;QACrD,IAAI,CAACI,IAAI,CAACM,MAAV,EAAkB;UAChB,IAAI,KAAKC,OAAL,CAAa,cAAb,MAAiCC,SAArC,EAAgD,MAAM,IAAIP,KAAJ,CAAU,sBAAV,CAAN;UAChD,KAAKJ,aAAL,CAAmBF,MAAnB,GAA4BF,WAAW,CAACS,QAAxC;UACA,KAAKC,QAAL,GAAgB,IAAIM,oBAAJ,CAAsB,KAAKF,OAAL,CAAa,cAAb,CAAtB,CAAhB;QACD,CAJD,MAIO,IAAAG,uBAAA,EAAY,KAAKH,OAAjB,EAA0BP,IAA1B,EAAgC,GAAhC;MACR,CAND,MAMO,IAAI,KAAKH,aAAL,CAAmBF,MAAnB,KAA8BF,WAAW,CAACS,QAA9C,EAAwD;QAC7D,KAAKC,QAAL,CAAcE,IAAd,CAAmBL,IAAnB;MACD;IACF"}