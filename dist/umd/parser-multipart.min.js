!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("newline-iterator")):"function"==typeof define&&define.amd?define(["exports","newline-iterator"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).parserMultipart={},e.newlineIterator)}(this,(function(e,t){"use strict";function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var r="undefined"==typeof Headers?function(){function e(t){var n,r,s;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),s=void 0,(r="headers")in(n=this)?Object.defineProperty(n,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[r]=s,this.headers=t}var t,r,s;return t=e,(r=[{key:"get",value:function(e){return this.headers[e]}},{key:"set",value:function(e,t){this.headers[e]=t}},{key:"append",value:function(e,t){this.headers[e]=t}},{key:"delete",value:function(e){delete this.headers[e]}},{key:"has",value:function(e){return void 0===this.headers[e]}},{key:"forEach",value:function(e){for(var t in this.headers)e(this.headers[t])}},{key:"getSetCookie",value:function(){throw new Error("Unsupported: getSetCookie")}}])&&n(t.prototype,r),s&&n(t,s),e}():Headers;function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),i(this,"_parser",void 0),i(this,"_bodyUsed",void 0),this._parser=t,this._bodyUsed=!1}var t,n,a;return t=e,(n=[{key:"type",get:function(){return"default"}},{key:"headers",get:function(){return new r(this._parser.headers.headers)}},{key:"body",get:function(){throw new Error("Not supported: body")}},{key:"ok",get:function(){return this._parser.headers.ok}},{key:"status",get:function(){return this._parser.headers.status}},{key:"statusText",get:function(){return this._parser.headers.statusText}},{key:"redirected",get:function(){return!1}},{key:"url",get:function(){return""}},{key:"clone",value:function(){return new e(this._parser)}},{key:"bodyUsed",get:function(){return this._bodyUsed}},{key:"text",value:function(){if(this._bodyUsed)throw new Error("Body already consumed");return this._bodyUsed=!0,Promise.resolve(this._parser.body)}},{key:"json",value:function(){if(this._bodyUsed)throw new Error("Body already consumed");return this._bodyUsed=!0,Promise.resolve(JSON.parse(this._parser.body))}},{key:"arrayBuffer",value:function(){throw new Error("Unsupported: arrayBuffer")}},{key:"blob",value:function(){throw new Error("Unsupported: blob")}},{key:"formData",value:function(){throw new Error("Unsupported: formData")}}])&&s(t.prototype,n),a&&s(t,a),e}();function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var u=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),o(this,"version",void 0),o(this,"headers",{}),o(this,"ok",void 0),o(this,"status",void 0),o(this,"statusText",void 0)};function h(e,t,n){var r=t.indexOf(n);if(-1===r)throw new Error("Unexpected header format: ".concat(t));var s=t.slice(0,r),i=t.slice(r+1);e[s.trim().toLowerCase()]=i.trim()}var p,l=/^[A-Z]+\/(\d)\.(\d) (\d{3}) (.*)$/;function f(e,n){for(var r=t(n),s=r.next();!s.done;)e.push(s.value),s=r.next();e.done()||e.push(null)}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e[e.Headers=1]="Headers",e[e.Body=2]="Body"}(p||(p={}));var y,v=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),d(this,"contentType",void 0),d(this,"headers",null),d(this,"body",null),d(this,"_parsingState",{status:2,lines:[]}),void 0===t)throw new Error("Response missing a content type");this.contentType=t,"application/http"===this.contentType&&(this.headers=new u,this._parsingState.status=1)}var t,n,r;return t=e,(n=[{key:"done",value:function(){return!this._parsingState}},{key:"parse",value:function(e){f(this,e)}},{key:"push",value:function(e){if(!this._parsingState)throw new Error("Attempting to parse a completed response");if(null===e){if(2!==this._parsingState.status)throw new Error("Unexpected parsing state");return this.body=this._parsingState.lines.join("\r\n"),void(this._parsingState=null)}1===this._parsingState.status?e.length?function(e,t){var n=t.match(l);return!!n&&(e.version={major:parseInt(n[1],10),minor:parseInt(n[2],10)},e.status=parseInt(n[3],10),e.statusText=n[4],e.ok="OK"===e.statusText,!0)}(this.headers,e)||h(this.headers.headers,e,":"):this._parsingState.status=2:2===this._parsingState.status&&(e.length?this._parsingState.lines.push(e):this.push(null))}},{key:"response",get:function(){if(this._parsingState)throw new Error("Attempting to use an incomplete response");return new a(this)}}])&&c(t.prototype,n),r&&c(t,r),e}();function g(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function b(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e[e.Headers=1]="Headers",e[e.Response=2]="Response"}(y||(y={}));var w,_=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),b(this,"headers",{}),b(this,"_response",void 0),b(this,"_parsingState",{status:1})}var t,n,r;return t=e,(n=[{key:"done",value:function(){return!this._parsingState}},{key:"parse",value:function(e){f(this,e)}},{key:"push",value:function(e){if(!this._parsingState)throw new Error("Attempting to parse a completed part");if(null===e){if(2!==this._parsingState.status)throw new Error("Unexpected parsing state");return this._response.done()||this._response.push(null),void(this._parsingState=null)}if(1===this._parsingState.status)if(e.length)h(this.headers,e,":");else{if(void 0===this.headers["content-type"])throw new Error("Missing content type");this._parsingState.status=2,this._response=new v(this.headers["content-type"])}else 2===this._parsingState.status&&this._response.push(e)}},{key:"response",get:function(){if(this._parsingState)throw new Error("Attempting to use an incomplete part");return this._response.response}}])&&g(t.prototype,n),r&&g(t,r),e}();function m(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function k(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e[e.Parts=1]="Parts"}(w||(w={}));var E=function(){function e(t){var n,r=this;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),k(this,"type",void 0),k(this,"headers",{}),k(this,"parts",[]),k(this,"_parsingState",{status:1,boundaryEnd:null}),k(this,"boundary",null),!t)throw new Error("Headers missing");if(!(n="string"==typeof t?t:t.get?t.get("content-type"):t["content-type"]))throw Error("content-type header not found");var s=n.split(/;/g);if(this.type=s.shift().trim(),0!==this.type.indexOf("multipart"))throw new Error("Expecting a multipart type. Received: ".concat(n));if(s.forEach((function(e){return h(r.headers,e,"=")})),!this.headers.boundary)throw new Error("Invalid Content Type: no boundary");this.boundary="--".concat(this.headers.boundary),this._parsingState.boundaryEnd="--".concat(this.headers.boundary,"--"),this._parsingState.status=1}var t,n,r;return t=e,(n=[{key:"done",value:function(){return!this._parsingState}},{key:"parse",value:function(e){return f(this,e),this}},{key:"push",value:function(e){var t=this.parts.length?this.parts[this.parts.length-1]:null;if(!this._parsingState)throw new Error("Attempting to parse a completed multipart");if(null===e)return t&&!t.done()&&t.push(null),void(this._parsingState=null);if(e===this._parsingState.boundaryEnd)this.push(null);else if(e===this.boundary)t&&!t.done()&&t.push(null),this.parts.push(new _);else if(t)t.push(e);else if(e.length)throw new Error("Unexpected line: ".concat(e))}},{key:"responses",get:function(){if(this._parsingState)throw new Error("Attempting to use an incomplete parser");return this.parts.map((function(e){return e.response}))}}])&&m(t.prototype,n),r&&m(t,r),e}();e.BodyHeaders=u,e.Parser=E,e.Part=_,e.Response=v,e.ResponseParsed=a}));
//# sourceMappingURL=parser-multipart.min.js.map
