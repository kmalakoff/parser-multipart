!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).parserMultipart={})}(this,(function(t){"use strict";function e(t,e,n){var r=e.indexOf(n);if(-1===r)throw new Error("Unexpected header format: ".concat(e));var s=e.slice(0,r),i=e.slice(r+1);t[s.trim().toLowerCase()]=i.trim()}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function r(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,s,i=[],a=!0,o=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){o=!0,s=t}finally{try{a||null==n.return||n.return()}finally{if(o)throw s}}return i}}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return n(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return n(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var s="undefined"!=typeof Symbol&&Symbol.iterator;function i(t){var e=0,n={next:function(){if(e>=t.length)return{value:void 0,done:!0};var n=r(function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e<0)throw new Error("Unexpected negative offset");if(e>t.length)throw new Error("Offset is longer than the string. Offset: ".concat(e,". String: ").concat(t.length));for(;e<t.length;){var r=t[e];if("\n"===r)return n?[e,1]:e;if("\r"===r)return n?[e,"\n"===t[e+1]?2:1]:e;e++}return n?[-1,0]:-1}(t,e,!0),2),s=n[0],i=n[1];s<0&&(s=t.length,i=0);var a=t.substr(e,s-e);return e=s+i,{value:a,done:!1}}};return s&&(n[Symbol.iterator]=function(){return this}),n}function a(t,e){for(var n=i(e),r=n.next();!r.done;)t.push(r.value),r=n.next();t.done()||t.push(null)}var o,u=/^[A-Z]+\/(\d)\.(\d) (\d{3}) (.*)$/;function h(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}!function(t){t[t.Headers=1]="Headers",t[t.Body=2]="Body"}(o||(o={}));var p,l=function t(){h(this,t),this.headers={}},f=function(){function t(e){if(h(this,t),this.headers=null,this.body=null,this._parsingState={status:o.Body,lines:[]},void 0===e)throw new Error("Response missing a content type");this.contentType=e,"application/http"===this.contentType&&(this.headers=new l,this._parsingState.status=o.Headers)}var n=t.prototype;return n.done=function(){return!this._parsingState},n.parse=function(t){a(this,t)},n.push=function(t){if(!this._parsingState)throw new Error("Attempting to parse a completed response");if(null===t){if(this._parsingState.status!==o.Body)throw new Error("Unexpected parsing state");return this.body=this._parsingState.lines.join("\r\n"),void(this._parsingState=null)}this._parsingState.status===o.Headers?t.length?function(t,e){var n=e.match(u);return!!n&&(t.version={major:parseInt(n[1],10),minor:parseInt(n[2],10)},t.status=parseInt(n[3],10),t.statusText=n[4],t.ok="OK"===t.statusText,!0)}(this.headers,t)||e(this.headers.headers,t,":"):this._parsingState.status=o.Body:this._parsingState.status===o.Body&&(t.length?this._parsingState.lines.push(t):this.push(null))},n.text=function(){if(this._parsingState)throw new Error("Attempting to use an incomplete response");return this.body},n.json=function(){if(this._parsingState)throw new Error("Attempting to use an incomplete response");return JSON.parse(this.body)},t}();!function(t){t[t.Headers=1]="Headers",t[t.Response=2]="Response"}(p||(p={}));var c,d=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.headers={},this._parsingState={status:p.Headers}}var n=t.prototype;return n.done=function(){return!this._parsingState},n.parse=function(t){a(this,t)},n.push=function(t){if(!this._parsingState)throw new Error("Attempting to parse a completed part");if(null===t){if(this._parsingState.status!==p.Response)throw new Error("Unexpected parsing state");return this.response.done()||this.response.push(null),void(this._parsingState=null)}if(this._parsingState.status===p.Headers)if(t.length)e(this.headers,t,":");else{if(void 0===this.headers["content-type"])throw new Error("Missing content type");this._parsingState.status=p.Response,this.response=new f(this.headers["content-type"])}else this._parsingState.status===p.Response&&this.response.push(t)},t}();!function(t){t[t.Parts=1]="Parts"}(c||(c={}));var g=function(){function t(n){var r,s=this;if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.headers={},this.parts=[],this._parsingState={status:c.Parts,boundaryEnd:null},this.boundary=null,!n)throw new Error("Headers missing");if(!(r="string"==typeof n?n:n.get?n.get("content-type"):n["content-type"]))throw Error("content-type header not found");var i=r.split(/;/g);if(this.type=i.shift().trim(),0!==this.type.indexOf("multipart"))throw new Error("Expecting a multipart type. Received: ".concat(r));if(i.forEach((function(t){return e(s.headers,t,"=")})),!this.headers.boundary)throw new Error("Invalid Content Type: no boundary");this.boundary="--".concat(this.headers.boundary),this._parsingState.boundaryEnd="--".concat(this.headers.boundary,"--"),this._parsingState.status=c.Parts}var n=t.prototype;return n.done=function(){return!this._parsingState},n.parse=function(t){a(this,t)},n.push=function(t){var e=this.parts.length?this.parts[this.parts.length-1]:null;if(!this._parsingState)throw new Error("Attempting to parse a completed multipart");if(null===t)return e&&!e.done()&&e.push(null),void(this._parsingState=null);if(t===this._parsingState.boundaryEnd)this.push(null);else if(t===this.boundary)e&&!e.done()&&e.push(null),this.parts.push(new d);else if(e)e.push(t);else if(t.length)throw new Error("Unexpected line: ".concat(t))},t}();t.Parser=g,t.Part=d,t.Response=f,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=parser-multipart.min.js.map
