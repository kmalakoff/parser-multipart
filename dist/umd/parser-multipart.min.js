!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).parserMultipart={})}(this,(function(e){"use strict";function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var n="undefined"==typeof Headers?function(){function e(t){var n,r,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),i=void 0,(r="headers")in(n=this)?Object.defineProperty(n,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[r]=i,this.headers=t}var n,r,i;return n=e,(r=[{key:"get",value:function(e){return this.headers[e]}},{key:"set",value:function(e,t){this.headers[e]=t}},{key:"append",value:function(e,t){this.headers[e]=t}},{key:"delete",value:function(e){delete this.headers[e]}},{key:"has",value:function(e){return void 0===this.headers[e]}},{key:"forEach",value:function(e){for(var t in this.headers)e(this.headers[t])}},{key:"getSetCookie",value:function(){throw new Error("Unsupported: getSetCookie")}}])&&t(n.prototype,r),i&&t(n,i),e}():Headers;function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var s=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),i(this,"_parser",void 0),i(this,"_bodyUsed",void 0),this._parser=t,this._bodyUsed=!1}var t,s,a;return t=e,(s=[{key:"type",get:function(){return"default"}},{key:"headers",get:function(){return new n(this._parser.headers.headers)}},{key:"body",get:function(){throw new Error("Not supported: body")}},{key:"ok",get:function(){return this._parser.headers.ok}},{key:"status",get:function(){return this._parser.headers.status}},{key:"statusText",get:function(){return this._parser.headers.statusText}},{key:"redirected",get:function(){return!1}},{key:"url",get:function(){return""}},{key:"clone",value:function(){return new e(this._parser)}},{key:"bodyUsed",get:function(){return this._bodyUsed}},{key:"text",value:function(){if(this._bodyUsed)throw new Error("Body already consumed");return this._bodyUsed=!0,Promise.resolve(this._parser.body)}},{key:"json",value:function(){if(this._bodyUsed)throw new Error("Body already consumed");return this._bodyUsed=!0,Promise.resolve(JSON.parse(this._parser.body))}},{key:"arrayBuffer",value:function(){throw new Error("Unsupported: arrayBuffer")}},{key:"blob",value:function(){throw new Error("Unsupported: blob")}},{key:"formData",value:function(){throw new Error("Unsupported: formData")}}])&&r(t.prototype,s),a&&r(t,a),e}();function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var o=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),a(this,"version",void 0),a(this,"headers",{}),a(this,"ok",void 0),a(this,"status",void 0),a(this,"statusText",void 0)};function u(e,t,n){var r=t.indexOf(n);if(-1===r)throw new Error("Unexpected header format: ".concat(t));var i=t.slice(0,r),s=t.slice(r+1);e[i.trim().toLowerCase()]=s.trim()}var h=/^[A-Z]+\/(\d)\.(\d) (\d{3}) (.*)$/;var f,l="undefined"!=typeof Symbol&&Symbol.iterator;function p(e){var t=0,n={next:function(){if(t>=e.length)return{value:void 0,done:!0};var n=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(t<0)throw new Error("Unexpected negative offset");if(t>e.length)throw new Error("Offset is longer than the string. Offset: ".concat(t,". String: ").concat(e.length));for(;t<e.length;){var r=e[t];if("\n"===r)return n?[t,1]:t;if("\r"===r)return n?[t,"\n"===e[t+1]?2:1]:t;t++}return n?[-1,0]:-1}(e,t,!0),r=n[0],i=n[1];r<0&&(r=e.length,i=0);var s=e.substr(t,r-t);return t=r+i,{value:s,done:!1}}};return l&&(n[Symbol.iterator]=function(){return this}),n}function c(e,t){for(var n=p(t),r=n.next();!r.done;)e.push(r.value),r=n.next();e.done()||e.push(null)}function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e[e.Headers=1]="Headers",e[e.Body=2]="Body"}(f||(f={}));var v,g=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),y(this,"contentType",void 0),y(this,"headers",null),y(this,"body",null),y(this,"_parsingState",{status:2,lines:[]}),void 0===t)throw new Error("Response missing a content type");this.contentType=t,"application/http"===this.contentType&&(this.headers=new o,this._parsingState.status=1)}var t,n,r;return t=e,(n=[{key:"done",value:function(){return!this._parsingState}},{key:"parse",value:function(e){c(this,e)}},{key:"push",value:function(e){if(!this._parsingState)throw new Error("Attempting to parse a completed response");if(null===e){if(2!==this._parsingState.status)throw new Error("Unexpected parsing state");return this.body=this._parsingState.lines.join("\r\n"),void(this._parsingState=null)}1===this._parsingState.status?e.length?function(e,t){var n=t.match(h);return!!n&&(e.version={major:parseInt(n[1],10),minor:parseInt(n[2],10)},e.status=parseInt(n[3],10),e.statusText=n[4],e.ok="OK"===e.statusText,!0)}(this.headers,e)||u(this.headers.headers,e,":"):this._parsingState.status=2:2===this._parsingState.status&&(e.length?this._parsingState.lines.push(e):this.push(null))}},{key:"response",get:function(){if(this._parsingState)throw new Error("Attempting to use an incomplete response");return new s(this)}}])&&d(t.prototype,n),r&&d(t,r),e}();function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function w(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e[e.Headers=1]="Headers",e[e.Response=2]="Response"}(v||(v={}));var _,m=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),w(this,"headers",{}),w(this,"_response",void 0),w(this,"_parsingState",{status:1})}var t,n,r;return t=e,(n=[{key:"done",value:function(){return!this._parsingState}},{key:"parse",value:function(e){c(this,e)}},{key:"push",value:function(e){if(!this._parsingState)throw new Error("Attempting to parse a completed part");if(null===e){if(2!==this._parsingState.status)throw new Error("Unexpected parsing state");return this._response.done()||this._response.push(null),void(this._parsingState=null)}if(1===this._parsingState.status)if(e.length)u(this.headers,e,":");else{if(void 0===this.headers["content-type"])throw new Error("Missing content type");this._parsingState.status=2,this._response=new g(this.headers["content-type"])}else 2===this._parsingState.status&&this._response.push(e)}},{key:"response",get:function(){if(this._parsingState)throw new Error("Attempting to use an incomplete part");return this._response.response}}])&&b(t.prototype,n),r&&b(t,r),e}();function k(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function E(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e[e.Parts=1]="Parts"}(_||(_={}));var S=function(){function e(t){var n,r=this;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),E(this,"type",void 0),E(this,"headers",{}),E(this,"parts",[]),E(this,"_parsingState",{status:1,boundaryEnd:null}),E(this,"boundary",null),!t)throw new Error("Headers missing");if(!(n="string"==typeof t?t:t.get?t.get("content-type"):t["content-type"]))throw Error("content-type header not found");var i=n.split(/;/g);if(this.type=i.shift().trim(),0!==this.type.indexOf("multipart"))throw new Error("Expecting a multipart type. Received: ".concat(n));if(i.forEach((function(e){return u(r.headers,e,"=")})),!this.headers.boundary)throw new Error("Invalid Content Type: no boundary");this.boundary="--".concat(this.headers.boundary),this._parsingState.boundaryEnd="--".concat(this.headers.boundary,"--"),this._parsingState.status=1}var t,n,r;return t=e,(n=[{key:"done",value:function(){return!this._parsingState}},{key:"parse",value:function(e){return c(this,e),this}},{key:"push",value:function(e){var t=this.parts.length?this.parts[this.parts.length-1]:null;if(!this._parsingState)throw new Error("Attempting to parse a completed multipart");if(null===e)return t&&!t.done()&&t.push(null),void(this._parsingState=null);if(e===this._parsingState.boundaryEnd)this.push(null);else if(e===this.boundary)t&&!t.done()&&t.push(null),this.parts.push(new m);else if(t)t.push(e);else if(e.length)throw new Error("Unexpected line: ".concat(e))}},{key:"responses",get:function(){if(this._parsingState)throw new Error("Attempting to use an incomplete parser");return this.parts.map((function(e){return e.response}))}}])&&k(t.prototype,n),r&&k(t,r),e}();e.Parser=S,e.Part=m,e.Response=g,e.ResponseParsed=s,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=parser-multipart.min.js.map
