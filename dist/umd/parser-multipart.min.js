!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("newline-iterator")):"function"==typeof define&&define.amd?define(["exports","newline-iterator"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).parserMultipart={},t.newlineIterator)}(this,(function(t,e){"use strict";function n(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var r=n(e);function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function a(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}function o(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function u(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function h(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return u(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,s=function(){};return{s:s,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,o=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){o=!0,i=t},f:function(){try{a||null==n.return||n.return()}finally{if(o)throw i}}}}function p(t,e,n){var r=e.indexOf(n);if(-1===r)throw new Error("Unexpected header format: ".concat(e));var s=e.slice(0,r),i=e.slice(r+1);t[s.trim().toLowerCase()]=i.trim()}function l(t,e){for(var n=r.default(e),s=n.next();!s.done;)t.push(s.value),s=n.next();t.done()||t.push(null)}var f,d=/^[A-Z]+\/(\d)\.(\d) (\d{3}) (.*)$/;!function(t){t[t.Headers=1]="Headers",t[t.Body=2]="Body"}(f||(f={}));var c,y=function(){function t(){s(this,t),o(this,"version",void 0),o(this,"headers",{}),o(this,"ok",void 0),o(this,"status",void 0),o(this,"statusText",void 0),o(this,"body",null),o(this,"_parsingState",{status:f.Headers,lines:[]})}return a(t,[{key:"done",value:function(){return!this._parsingState}},{key:"parse",value:function(t){l(this,t)}},{key:"push",value:function(t){if(!this._parsingState)throw new Error("Attempting to parse a completed response");if(null===t){if(this._parsingState.status!==f.Body)throw new Error("Unexpected parsing state");return this.body=this._parsingState.lines.join("\r\n"),void(this._parsingState=null)}this._parsingState.status===f.Headers?t.length?function(t,e){var n=e.match(d);return!!n&&(t.version={major:parseInt(n[1],10),minor:parseInt(n[2],10)},t.status=parseInt(n[3],10),t.statusText=n[4],t.ok="OK"===t.statusText,!0)}(this,t)||p(this.headers,t,":"):this._parsingState.status=f.Body:this._parsingState.status===f.Body&&(t.length?this._parsingState.lines.push(t):this.push(null))}},{key:"text",value:function(){if(this._parsingState)throw new Error("Attempting to use an incomplete response");return this.body}},{key:"json",value:function(){if(this._parsingState)throw new Error("Attempting to use an incomplete response");if(-1===this.headers["content-type"].indexOf("application/json"))throw new Error("Not json response. Content type: ".concat(this.headers["content-type"]));return JSON.parse(this.body)}}]),t}();!function(t){t[t.Headers=1]="Headers",t[t.Response=2]="Response"}(c||(c={}));var g,v=function(){function t(){s(this,t),o(this,"headers",{}),o(this,"response",new y),o(this,"_parsingState",{status:c.Headers})}return a(t,[{key:"done",value:function(){return!this._parsingState}},{key:"parse",value:function(t){l(this,t)}},{key:"push",value:function(t){if(!this._parsingState)throw new Error("Attempting to parse a completed part");if(null===t){if(this._parsingState.status!==c.Response)throw new Error("Unexpected parsing state");return this.response.done()||this.response.push(null),void(this._parsingState=null)}if(this._parsingState.status===c.Headers)if(t.length)p(this.headers,t,":");else{if("application/http"!==this.headers["content-type"])throw new Error("Unexpected content type: ".concat(this.headers["content-type"]));this._parsingState.status=c.Response}else this._parsingState.status===c.Response&&this.response.push(t)}}]),t}();!function(t){t[t.Parts=1]="Parts"}(g||(g={}));var w=function(){function t(e){if(s(this,t),o(this,"type",void 0),o(this,"headers",{}),o(this,"parts",[]),o(this,"_parsingState",{status:g.Parts,boundaryEnd:null}),o(this,"boundary",null),!e)throw new Error("Headers missing");var n;if(!(n="string"==typeof e?e:e.get?e.get("content-type"):e["content-type"]))throw Error("content-type header not found");var r=n.split(/;/g);if(this.type=r.shift().trim(),0!==this.type.indexOf("multipart"))throw new Error("Expecting a multipart type. Received: ".concat(n));var i,a=h(r);try{for(a.s();!(i=a.n()).done;){var u=i.value;p(this.headers,u,"=")}}catch(t){a.e(t)}finally{a.f()}if(!this.headers.boundary)throw new Error("Invalid Content Type: no boundary");this.boundary="--".concat(this.headers.boundary),this._parsingState.boundaryEnd="--".concat(this.headers.boundary,"--"),this._parsingState.status=g.Parts}return a(t,[{key:"done",value:function(){return!this._parsingState}},{key:"parse",value:function(t){l(this,t)}},{key:"push",value:function(t){var e=this.parts.length?this.parts[this.parts.length-1]:null;if(!this._parsingState)throw new Error("Attempting to parse a completed multipart");if(null===t)return e&&!e.done()&&e.push(null),void(this._parsingState=null);if(t===this._parsingState.boundaryEnd)this.push(null);else if(t===this.boundary)e&&!e.done()&&e.push(null),this.parts.push(new v);else if(e)e.push(t);else if(t.length)throw new Error("Unexpected line: ".concat(t))}}]),t}();t.Parser=w,t.Part=v,t.Response=y,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=parser-multipart.min.js.map
