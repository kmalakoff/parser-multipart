!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).parserMultipart={})}(this,(function(t){"use strict";function e(t,e,n){var r=e.indexOf(n);if(-1===r)throw new Error("Unexpected header format: ".concat(e));var s=e.slice(0,r),o=e.slice(r+1);t[s.trim().toLowerCase()]=o.trim()}var n="undefined"!=typeof Symbol&&Symbol.iterator;function r(t){var e=0,r={next:function(){if(e>=t.length)return{value:void 0,done:!0};var n=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e<0)throw new Error("Unexpected negative offset");if(e>t.length)throw new Error("Offset is longer than the string. Offset: ".concat(e,". String: ").concat(t.length));for(;e<t.length;){var r=t[e];if("\n"===r)return n?[e,1]:e;if("\r"===r)return n?[e,"\n"===t[e+1]?2:1]:e;e++}return n?[-1,0]:-1}(t,e,!0),r=n[0],s=n[1];r<0&&(r=t.length,s=0);var o=t.substr(e,r-e);return e=r+s,{value:o,done:!1}}};return n&&(r[Symbol.iterator]=function(){return this}),r}function s(t,e){for(var n=r(e),s=n.next();!s.done;)t.push(s.value),s=n.next();t.done()||t.push(null)}var o=/^[A-Z]+\/(\d)\.(\d) (\d{3}) (.*)$/;function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var a=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._parser=e,this._bodyUsed=!1}var e,n,r,s=t.prototype;return s.clone=function(){return new t(this._parser)},s.text=function(){if(this._bodyUsed)throw new Error("Body already consumed");return this._bodyUsed=!0,Promise.resolve(this._parser.body)},s.json=function(){if(this._bodyUsed)throw new Error("Body already consumed");return this._bodyUsed=!0,Promise.resolve(JSON.parse(this._parser.body))},s.arrayBuffer=function(){throw new Error("Unsupported: arrayBuffer")},s.blob=function(){throw new Error("Unsupported: blob")},s.formData=function(){throw new Error("Unsupported: formData")},e=t,(n=[{key:"type",get:function(){return"default"}},{key:"headers",get:function(){return new Headers(this._parser.headers.headers)}},{key:"body",get:function(){throw new Error("Not supported: body")}},{key:"ok",get:function(){return this._parser.headers.ok}},{key:"status",get:function(){return this._parser.headers.status}},{key:"statusText",get:function(){return this._parser.headers.statusText}},{key:"redirected",get:function(){return!1}},{key:"url",get:function(){return""}},{key:"bodyUsed",get:function(){return this._bodyUsed}}])&&i(e.prototype,n),r&&i(e,r),t}();var u,h=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.headers={}};function p(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}!function(t){t[t.Headers=1]="Headers",t[t.Body=2]="Body"}(u||(u={}));var f,d=function(){function t(e){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.headers=null,this.body=null,this._parsingState={status:u.Body,lines:[]},void 0===e)throw new Error("Response missing a content type");this.contentType=e,"application/http"===this.contentType&&(this.headers=new h,this._parsingState.status=u.Headers)}var n,r,i,f=t.prototype;return f.done=function(){return!this._parsingState},f.parse=function(t){s(this,t)},f.push=function(t){if(!this._parsingState)throw new Error("Attempting to parse a completed response");if(null===t){if(this._parsingState.status!==u.Body)throw new Error("Unexpected parsing state");return this.body=this._parsingState.lines.join("\r\n"),void(this._parsingState=null)}this._parsingState.status===u.Headers?t.length?function(t,e){var n=e.match(o);return!!n&&(t.version={major:parseInt(n[1],10),minor:parseInt(n[2],10)},t.status=parseInt(n[3],10),t.statusText=n[4],t.ok="OK"===t.statusText,!0)}(this.headers,t)||e(this.headers.headers,t,":"):this._parsingState.status=u.Body:this._parsingState.status===u.Body&&(t.length?this._parsingState.lines.push(t):this.push(null))},n=t,(r=[{key:"response",get:function(){if(this._parsingState)throw new Error("Attempting to use an incomplete response");return new a(this)}}])&&p(n.prototype,r),i&&p(n,i),t}();function c(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}!function(t){t[t.Headers=1]="Headers",t[t.Response=2]="Response"}(f||(f={}));var l,y=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.headers={},this._parsingState={status:f.Headers}}var n,r,o,i=t.prototype;return i.done=function(){return!this._parsingState},i.parse=function(t){s(this,t)},i.push=function(t){if(!this._parsingState)throw new Error("Attempting to parse a completed part");if(null===t){if(this._parsingState.status!==f.Response)throw new Error("Unexpected parsing state");return this._response.done()||this._response.push(null),void(this._parsingState=null)}if(this._parsingState.status===f.Headers)if(t.length)e(this.headers,t,":");else{if(void 0===this.headers["content-type"])throw new Error("Missing content type");this._parsingState.status=f.Response,this._response=new d(this.headers["content-type"])}else this._parsingState.status===f.Response&&this._response.push(t)},n=t,(r=[{key:"response",get:function(){if(this._parsingState)throw new Error("Attempting to use an incomplete part");return this._response.response}}])&&c(n.prototype,r),o&&c(n,o),t}();function g(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}!function(t){t[t.Parts=1]="Parts"}(l||(l={}));var w=function(){function t(n){var r,s=this;if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.headers={},this.parts=[],this._parsingState={status:l.Parts,boundaryEnd:null},this.boundary=null,!n)throw new Error("Headers missing");if(!(r="string"==typeof n?n:n.get?n.get("content-type"):n["content-type"]))throw Error("content-type header not found");var o=r.split(/;/g);if(this.type=o.shift().trim(),0!==this.type.indexOf("multipart"))throw new Error("Expecting a multipart type. Received: ".concat(r));if(o.forEach((function(t){return e(s.headers,t,"=")})),!this.headers.boundary)throw new Error("Invalid Content Type: no boundary");this.boundary="--".concat(this.headers.boundary),this._parsingState.boundaryEnd="--".concat(this.headers.boundary,"--"),this._parsingState.status=l.Parts}var n,r,o,i=t.prototype;return i.done=function(){return!this._parsingState},i.parse=function(t){return s(this,t),this},i.push=function(t){var e=this.parts.length?this.parts[this.parts.length-1]:null;if(!this._parsingState)throw new Error("Attempting to parse a completed multipart");if(null===t)return e&&!e.done()&&e.push(null),void(this._parsingState=null);if(t===this._parsingState.boundaryEnd)this.push(null);else if(t===this.boundary)e&&!e.done()&&e.push(null),this.parts.push(new y);else if(e)e.push(t);else if(t.length)throw new Error("Unexpected line: ".concat(t))},n=t,(r=[{key:"responses",get:function(){if(this._parsingState)throw new Error("Attempting to use an incomplete parser");return this.parts.map((function(t){return t.response}))}}])&&g(n.prototype,r),o&&g(n,o),t}();t.Parser=w,t.Part=y,t.Response=d,t.ResponseParsed=a,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=parser-multipart.min.js.map
