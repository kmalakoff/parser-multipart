!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).parserMultipart={})}(this,(function(t){"use strict";var e="undefined"==typeof Headers?function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.headers=e}var e=t.prototype;return e.get=function(t){return this.headers[t]},e.set=function(t,e){this.headers[t]=e},e.append=function(t,e){this.headers[t]=e},e.delete=function(t){delete this.headers[t]},e.has=function(t){return void 0===this.headers[t]},e.forEach=function(t){for(var e in this.headers)t(this.headers[e])},e.getSetCookie=function(){throw new Error("Unsupported: getSetCookie")},t}():Headers;function n(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var r=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._parser=e,this._bodyUsed=!1}var r,s,o,i=t.prototype;return i.clone=function(){return new t(this._parser)},i.text=function(){if(this._bodyUsed)throw new Error("Body already consumed");return this._bodyUsed=!0,Promise.resolve(this._parser.body)},i.json=function(){if(this._bodyUsed)throw new Error("Body already consumed");return this._bodyUsed=!0,Promise.resolve(JSON.parse(this._parser.body))},i.arrayBuffer=function(){throw new Error("Unsupported: arrayBuffer")},i.blob=function(){throw new Error("Unsupported: blob")},i.formData=function(){throw new Error("Unsupported: formData")},r=t,(s=[{key:"type",get:function(){return"default"}},{key:"headers",get:function(){return new e(this._parser.headers.headers)}},{key:"body",get:function(){throw new Error("Not supported: body")}},{key:"ok",get:function(){return this._parser.headers.ok}},{key:"status",get:function(){return this._parser.headers.status}},{key:"statusText",get:function(){return this._parser.headers.statusText}},{key:"redirected",get:function(){return!1}},{key:"url",get:function(){return""}},{key:"bodyUsed",get:function(){return this._bodyUsed}}])&&n(r.prototype,s),o&&n(r,o),t}();var s=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.headers={}};function o(t,e,n){var r=e.indexOf(n);if(-1===r)throw new Error("Unexpected header format: ".concat(e));var s=e.slice(0,r),o=e.slice(r+1);t[s.trim().toLowerCase()]=o.trim()}var i=/^[A-Z]+\/(\d)\.(\d) (\d{3}) (.*)$/;var a,u="undefined"!=typeof Symbol&&Symbol.iterator;function h(t){var e=0,n={next:function(){if(e>=t.length)return{value:void 0,done:!0};var n=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e<0)throw new Error("Unexpected negative offset");if(e>t.length)throw new Error("Offset is longer than the string. Offset: ".concat(e,". String: ").concat(t.length));for(;e<t.length;){var r=t[e];if("\n"===r)return n?[e,1]:e;if("\r"===r)return n?[e,"\n"===t[e+1]?2:1]:e;e++}return n?[-1,0]:-1}(t,e,!0),r=n[0],s=n[1];r<0&&(r=t.length,s=0);var o=t.substr(e,r-e);return e=r+s,{value:o,done:!1}}};return u&&(n[Symbol.iterator]=function(){return this}),n}function p(t,e){for(var n=h(e),r=n.next();!r.done;)t.push(r.value),r=n.next();t.done()||t.push(null)}function f(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}!function(t){t[t.Headers=1]="Headers",t[t.Body=2]="Body"}(a||(a={}));var d,c=function(){function t(e){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.headers=null,this.body=null,this._parsingState={status:a.Body,lines:[]},void 0===e)throw new Error("Response missing a content type");this.contentType=e,"application/http"===this.contentType&&(this.headers=new s,this._parsingState.status=a.Headers)}var e,n,u,h=t.prototype;return h.done=function(){return!this._parsingState},h.parse=function(t){p(this,t)},h.push=function(t){if(!this._parsingState)throw new Error("Attempting to parse a completed response");if(null===t){if(this._parsingState.status!==a.Body)throw new Error("Unexpected parsing state");return this.body=this._parsingState.lines.join("\r\n"),void(this._parsingState=null)}this._parsingState.status===a.Headers?t.length?function(t,e){var n=e.match(i);return!!n&&(t.version={major:parseInt(n[1],10),minor:parseInt(n[2],10)},t.status=parseInt(n[3],10),t.statusText=n[4],t.ok="OK"===t.statusText,!0)}(this.headers,t)||o(this.headers.headers,t,":"):this._parsingState.status=a.Body:this._parsingState.status===a.Body&&(t.length?this._parsingState.lines.push(t):this.push(null))},e=t,(n=[{key:"response",get:function(){if(this._parsingState)throw new Error("Attempting to use an incomplete response");return new r(this)}}])&&f(e.prototype,n),u&&f(e,u),t}();function l(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}!function(t){t[t.Headers=1]="Headers",t[t.Response=2]="Response"}(d||(d={}));var y,g=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.headers={},this._parsingState={status:d.Headers}}var e,n,r,s=t.prototype;return s.done=function(){return!this._parsingState},s.parse=function(t){p(this,t)},s.push=function(t){if(!this._parsingState)throw new Error("Attempting to parse a completed part");if(null===t){if(this._parsingState.status!==d.Response)throw new Error("Unexpected parsing state");return this._response.done()||this._response.push(null),void(this._parsingState=null)}if(this._parsingState.status===d.Headers)if(t.length)o(this.headers,t,":");else{if(void 0===this.headers["content-type"])throw new Error("Missing content type");this._parsingState.status=d.Response,this._response=new c(this.headers["content-type"])}else this._parsingState.status===d.Response&&this._response.push(t)},e=t,(n=[{key:"response",get:function(){if(this._parsingState)throw new Error("Attempting to use an incomplete part");return this._response.response}}])&&l(e.prototype,n),r&&l(e,r),t}();function w(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}!function(t){t[t.Parts=1]="Parts"}(y||(y={}));var v=function(){function t(e){var n,r=this;if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.headers={},this.parts=[],this._parsingState={status:y.Parts,boundaryEnd:null},this.boundary=null,!e)throw new Error("Headers missing");if(!(n="string"==typeof e?e:e.get?e.get("content-type"):e["content-type"]))throw Error("content-type header not found");var s=n.split(/;/g);if(this.type=s.shift().trim(),0!==this.type.indexOf("multipart"))throw new Error("Expecting a multipart type. Received: ".concat(n));if(s.forEach((function(t){return o(r.headers,t,"=")})),!this.headers.boundary)throw new Error("Invalid Content Type: no boundary");this.boundary="--".concat(this.headers.boundary),this._parsingState.boundaryEnd="--".concat(this.headers.boundary,"--"),this._parsingState.status=y.Parts}var e,n,r,s=t.prototype;return s.done=function(){return!this._parsingState},s.parse=function(t){return p(this,t),this},s.push=function(t){var e=this.parts.length?this.parts[this.parts.length-1]:null;if(!this._parsingState)throw new Error("Attempting to parse a completed multipart");if(null===t)return e&&!e.done()&&e.push(null),void(this._parsingState=null);if(t===this._parsingState.boundaryEnd)this.push(null);else if(t===this.boundary)e&&!e.done()&&e.push(null),this.parts.push(new g);else if(e)e.push(t);else if(t.length)throw new Error("Unexpected line: ".concat(t))},e=t,(n=[{key:"responses",get:function(){if(this._parsingState)throw new Error("Attempting to use an incomplete parser");return this.parts.map((function(t){return t.response}))}}])&&w(e.prototype,n),r&&w(e,r),t}();t.Parser=v,t.Part=g,t.Response=c,t.ResponseParsed=r,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=parser-multipart.min.js.map
