!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).parserMultipart={})}(this,(function(t){"use strict";function e(t,e,n){var s=e.indexOf(n);if(-1===s)throw new Error("Unexpected header format: ".concat(e));var r=e.slice(0,s),i=e.slice(s+1);t[r.trim().toLowerCase()]=i.trim()}var n="undefined"!=typeof Symbol&&Symbol.iterator;function s(t){var e=0,s={next:function(){if(e>=t.length)return{value:void 0,done:!0};var n=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e<0)throw new Error("Unexpected negative offset");if(e>t.length)throw new Error("Offset is longer than the string. Offset: ".concat(e,". String: ").concat(t.length));for(;e<t.length;){var s=t[e];if("\n"===s)return n?[e,1]:e;if("\r"===s)return n?[e,"\n"===t[e+1]?2:1]:e;e++}return n?[-1,0]:-1}(t,e,!0),s=n[0],r=n[1];s<0&&(s=t.length,r=0);var i=t.substr(e,s-e);return e=s+r,{value:i,done:!1}}};return n&&(s[Symbol.iterator]=function(){return this}),s}function r(t,e){for(var n=s(e),r=n.next();!r.done;)t.push(r.value),r=n.next();t.done()||t.push(null)}var i,a=/^[A-Z]+\/(\d)\.(\d) (\d{3}) (.*)$/;function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}!function(t){t[t.Headers=1]="Headers",t[t.Body=2]="Body"}(i||(i={}));var h,u=function t(){o(this,t),this.headers={}},p=function(){function t(e){if(o(this,t),this.headers=null,this.body=null,this._parsingState={status:i.Body,lines:[]},void 0===e)throw new Error("Response missing a content type");this.contentType=e,"application/http"===this.contentType&&(this.headers=new u,this._parsingState.status=i.Headers)}var n=t.prototype;return n.done=function(){return!this._parsingState},n.parse=function(t){r(this,t)},n.push=function(t){if(!this._parsingState)throw new Error("Attempting to parse a completed response");if(null===t){if(this._parsingState.status!==i.Body)throw new Error("Unexpected parsing state");return this.body=this._parsingState.lines.join("\r\n"),void(this._parsingState=null)}this._parsingState.status===i.Headers?t.length?function(t,e){var n=e.match(a);return!!n&&(t.version={major:parseInt(n[1],10),minor:parseInt(n[2],10)},t.status=parseInt(n[3],10),t.statusText=n[4],t.ok="OK"===t.statusText,!0)}(this.headers,t)||e(this.headers.headers,t,":"):this._parsingState.status=i.Body:this._parsingState.status===i.Body&&(t.length?this._parsingState.lines.push(t):this.push(null))},n.text=function(){if(this._parsingState)throw new Error("Attempting to use an incomplete response");return this.body},n.json=function(){if(this._parsingState)throw new Error("Attempting to use an incomplete response");return JSON.parse(this.body)},t}();!function(t){t[t.Headers=1]="Headers",t[t.Response=2]="Response"}(h||(h={}));var f,d=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.headers={},this._parsingState={status:h.Headers}}var n=t.prototype;return n.done=function(){return!this._parsingState},n.parse=function(t){r(this,t)},n.push=function(t){if(!this._parsingState)throw new Error("Attempting to parse a completed part");if(null===t){if(this._parsingState.status!==h.Response)throw new Error("Unexpected parsing state");return this.response.done()||this.response.push(null),void(this._parsingState=null)}if(this._parsingState.status===h.Headers)if(t.length)e(this.headers,t,":");else{if(void 0===this.headers["content-type"])throw new Error("Missing content type");this._parsingState.status=h.Response,this.response=new p(this.headers["content-type"])}else this._parsingState.status===h.Response&&this.response.push(t)},t}();!function(t){t[t.Parts=1]="Parts"}(f||(f={}));var l=function(){function t(n){var s,r=this;if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.headers={},this.parts=[],this._parsingState={status:f.Parts,boundaryEnd:null},this.boundary=null,!n)throw new Error("Headers missing");if(!(s="string"==typeof n?n:n.get?n.get("content-type"):n["content-type"]))throw Error("content-type header not found");var i=s.split(/;/g);if(this.type=i.shift().trim(),0!==this.type.indexOf("multipart"))throw new Error("Expecting a multipart type. Received: ".concat(s));if(i.forEach((function(t){return e(r.headers,t,"=")})),!this.headers.boundary)throw new Error("Invalid Content Type: no boundary");this.boundary="--".concat(this.headers.boundary),this._parsingState.boundaryEnd="--".concat(this.headers.boundary,"--"),this._parsingState.status=f.Parts}var n=t.prototype;return n.done=function(){return!this._parsingState},n.parse=function(t){r(this,t)},n.push=function(t){var e=this.parts.length?this.parts[this.parts.length-1]:null;if(!this._parsingState)throw new Error("Attempting to parse a completed multipart");if(null===t)return e&&!e.done()&&e.push(null),void(this._parsingState=null);if(t===this._parsingState.boundaryEnd)this.push(null);else if(t===this.boundary)e&&!e.done()&&e.push(null),this.parts.push(new d);else if(e)e.push(t);else if(t.length)throw new Error("Unexpected line: ".concat(t))},t}();t.Parser=l,t.Part=d,t.Response=p,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=parser-multipart.min.js.map
