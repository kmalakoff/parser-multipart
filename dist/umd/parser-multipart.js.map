{"version":3,"file":"parser-multipart.js","sources":["../../src/lib/HeadersPolyfill.ts","../../src/ResponseParsed.ts","../../src/lib/BodyHeaders.ts","../../src/lib/parseHeader.ts","../../src/lib/parseStatus.ts","../../node_modules/index-of-newline/dist/esm/index.mjs","../../node_modules/newline-iterator/dist/esm/index.mjs","../../src/lib/parseText.ts","../../src/ResponseParser.ts","../../src/PartParser.ts","../../src/MultipartParser.ts"],"sourcesContent":["class HeadersPolyfill implements Headers {\n  headers: Record<string, string>;\n\n  constructor(headers) {\n    this.headers = headers;\n  }\n  get(key) {\n    return this.headers[key];\n  }\n  set(key, value) {\n    this.headers[key] = value;\n  }\n  append(key, value) {\n    this.headers[key] = value;\n  }\n  delete(key) {\n    delete this.headers[key];\n  }\n  has(key) {\n    return this.headers[key] === undefined;\n  }\n  forEach(fn) {\n    for (var key in this.headers) fn(this.headers[key]);\n  }\n  getSetCookie(): string[] {\n    throw new Error('Unsupported: getSetCookie');\n  }\n}\n\nexport default typeof Headers === 'undefined' ? HeadersPolyfill : Headers;\n","// @ts-ignore\nimport BodyHeaders from './lib/BodyHeaders.js';\n// @ts-ignore\nimport HeadersPolyfill from './lib/HeadersPolyfill.ts';\n\nexport interface Parser {\n  headers: BodyHeaders;\n  body: string;\n}\n\nexport default class ParsedResponse implements Response {\n  private _parser: Parser;\n  private _bodyUsed: boolean;\n\n  constructor(parser: Parser) {\n    this._parser = parser;\n    this._bodyUsed = false;\n  }\n\n  get type(): ResponseType {\n    return 'default';\n  }\n  get headers() {\n    return new HeadersPolyfill(this._parser.headers.headers as unknown as Record<string, string>);\n  }\n\n  get body(): ReadableStream<Uint8Array> {\n    throw new Error('Not supported: body');\n  }\n\n  get ok() {\n    return this._parser.headers.ok;\n  }\n  get status() {\n    return this._parser.headers.status;\n  }\n  get statusText() {\n    return this._parser.headers.statusText;\n  }\n  get redirected() {\n    return false;\n  }\n  get url() {\n    return '';\n  }\n  clone() {\n    return new ParsedResponse(this._parser);\n  }\n  get bodyUsed() {\n    return this._bodyUsed;\n  }\n\n  text(): Promise<string> {\n    if (this._bodyUsed) throw new Error('Body already consumed');\n    this._bodyUsed = true;\n    return Promise.resolve(this._parser.body);\n  }\n\n  json(): Promise<unknown> {\n    if (this._bodyUsed) throw new Error('Body already consumed');\n    this._bodyUsed = true;\n    return Promise.resolve(JSON.parse(this._parser.body));\n  }\n\n  arrayBuffer(): Promise<ArrayBuffer> {\n    throw new Error('Unsupported: arrayBuffer');\n  }\n\n  blob(): Promise<Blob> {\n    throw new Error('Unsupported: blob');\n  }\n\n  formData(): Promise<FormData> {\n    throw new Error('Unsupported: formData');\n  }\n}\n","// @ts-ignore\nimport type { Version } from './types.ts';\n\nexport default class BodyHeaders {\n  version: Version;\n  headers: Record<string, string> = {};\n  ok: boolean;\n  status: number;\n  statusText: string;\n}\n","export default function parseHeader(result: Record<string, string>, line: string, delimiter: string): void {\n  const index = line.indexOf(delimiter);\n  if (index === -1) throw new Error(`Unexpected header format: ${line}`);\n  const key = line.slice(0, index);\n  const value = line.slice(index + 1);\n  result[key.trim().toLowerCase()] = value.trim();\n}\n","// @ts-ignore\nimport { Version } from '../index.ts';\n\nexport interface StatusResult {\n  version: Version;\n  ok: boolean;\n  status: number;\n  statusText: string;\n}\n\n// https://github.com/watson/http-headers/blob/master/index.ts\nconst statusLine = /^[A-Z]+\\/(\\d)\\.(\\d) (\\d{3}) (.*)$/;\n\nexport default function parseStatus(result: StatusResult, line: string): boolean {\n  const match = line.match(statusLine);\n  if (!match) return false;\n\n  result.version = {\n    major: parseInt(match[1], 10),\n    minor: parseInt(match[2], 10),\n  };\n  result.status = parseInt(match[3], 10);\n  result.statusText = match[4];\n  result.ok = result.statusText === 'OK';\n  return true;\n}\n","/**\n * Find indexOf CR, LF, or CRLF\n *\n * @param string The search string\n * @param offset The offset for searching\n * @param includeLength Include the length in the return value\n * @returns When includeLength is true, returns a pair of [offset, length] to provide the length of CR (1), LF (1) or CRLF (2)\n */ export default function indexOfNewline(string, offset = 0, includeLength = false) {\n    if (offset < 0) throw new Error('Unexpected negative offset');\n    if (offset > string.length) throw new Error(`Offset is longer than the string. Offset: ${offset}. String: ${string.length}`);\n    while(offset < string.length){\n        const value = string[offset];\n        if (value === '\\n') return includeLength ? [\n            offset,\n            1\n        ] : offset;\n        else if (value === '\\r') {\n            return includeLength ? [\n                offset,\n                string[offset + 1] === '\\n' ? 2 : 1\n            ] : offset;\n        }\n        offset++;\n    }\n    return includeLength ? [\n        -1,\n        0\n    ] : -1;\n};\n","import indexOfNewline from 'index-of-newline';\nconst hasIterator = typeof Symbol !== 'undefined' && Symbol.iterator;\n/**\n * Create a newline iterator recognizing CR, LF, and CRLF using the Symbol.iterator interface\n *\n * @param string The string to iterate through\n *\n * ```typescript\n * import newlineIterator from \"newline-iterator\";\n *\n * const iterator = newlineIterator(\"some\\r\\nstring\\ncombination\\r\");\n * const results = [];\n * for (const line of iterator) results.push(line);\n * console.log(results); // [\"some\", \"string\", \"combination\"];\n * ```\n */ export default function newlineIterator(string) {\n    let offset = 0;\n    const iterator = {\n        next () {\n            if (offset >= string.length) return {\n                value: undefined,\n                done: true\n            };\n            const args = indexOfNewline(string, offset, true);\n            let index = args[0];\n            let skip = args[1];\n            if (index < 0) {\n                index = string.length;\n                skip = 0;\n            }\n            const line = string.substr(offset, index - offset);\n            offset = index + skip;\n            return {\n                value: line,\n                done: false\n            };\n        }\n    };\n    if (hasIterator) {\n        iterator[Symbol.iterator] = function() {\n            return this;\n        };\n    }\n    return iterator;\n};\n","import newlineIterator from 'newline-iterator';\n// @ts-ignore\nimport { IParser } from '../index.ts';\n\nexport default function parseText(parser: IParser, text: string): void {\n  const iterator = newlineIterator(text);\n  let next = iterator.next();\n  while (!next.done) {\n    parser.push(next.value);\n    next = iterator.next();\n  }\n  if (!parser.done()) parser.push(null);\n}\n","// @ts-ignore\nimport ResponseParsed from './ResponseParsed.ts';\n// @ts-ignore\nimport type { Parser } from './ResponseParsed.ts';\n// @ts-ignore\nimport BodyHeaders from './lib/BodyHeaders.ts';\n// @ts-ignore\nimport parseHeader from './lib/parseHeader.ts';\n// @ts-ignore\nimport parseStatus from './lib/parseStatus.ts';\n// @ts-ignore\nimport parseText from './lib/parseText.ts';\n\nexport enum ParseStatus {\n  Headers = 1,\n  Body = 2,\n}\n\nexport interface ParsingState {\n  status: ParseStatus;\n  lines: string[];\n}\n\nexport default class MultipartResponse {\n  contentType: string;\n  headers: BodyHeaders = null;\n  body: string = null;\n\n  private _parsingState: ParsingState | null = {\n    status: ParseStatus.Body,\n    lines: [],\n  };\n\n  constructor(contentType: string) {\n    if (contentType === undefined) throw new Error('Response missing a content type');\n    this.contentType = contentType;\n    if (this.contentType === 'application/http') {\n      this.headers = new BodyHeaders();\n      this._parsingState.status = ParseStatus.Headers;\n    }\n  }\n\n  done(): boolean {\n    return !this._parsingState;\n  }\n\n  parse(text: string): void {\n    parseText(this, text);\n  }\n\n  push(line: string): void {\n    if (!this._parsingState) throw new Error('Attempting to parse a completed response');\n    if (line === null) {\n      if (this._parsingState.status !== ParseStatus.Body) throw new Error('Unexpected parsing state');\n      this.body = this._parsingState.lines.join('\\r\\n');\n      this._parsingState = null;\n      return;\n    }\n\n    if (this._parsingState.status === ParseStatus.Headers) {\n      if (!line.length) this._parsingState.status = ParseStatus.Body;\n      else if (!parseStatus(this.headers, line)) parseHeader(this.headers.headers, line, ':');\n    } else if (this._parsingState.status === ParseStatus.Body) {\n      if (!line.length) this.push(null);\n      else this._parsingState.lines.push(line);\n    }\n  }\n\n  get response(): Response {\n    if (this._parsingState) throw new Error('Attempting to use an incomplete response');\n    return new ResponseParsed(this as Parser);\n  }\n}\n","// @ts-ignore\nimport MultipartResponse from './ResponseParser.ts';\n// @ts-ignore\nimport parseHeader from './lib/parseHeader.ts';\n// @ts-ignore\nimport parseText from './lib/parseText.ts';\n\nexport enum ParseStatus {\n  Headers = 1,\n  Response = 2,\n}\n\nexport interface ParsingState {\n  status: ParseStatus;\n}\n\nexport default class MultipartPart {\n  headers: Record<string, string> = {};\n  _response: MultipartResponse | null;\n\n  private _parsingState: ParsingState | null = {\n    status: ParseStatus.Headers,\n  };\n\n  done(): boolean {\n    return !this._parsingState;\n  }\n\n  parse(text: string): void {\n    parseText(this, text);\n  }\n\n  push(line: string): void {\n    if (!this._parsingState) throw new Error('Attempting to parse a completed part');\n    if (line === null) {\n      if (this._parsingState.status !== ParseStatus.Response) throw new Error('Unexpected parsing state');\n      if (!this._response.done()) this._response.push(null);\n      this._parsingState = null;\n      return;\n    }\n\n    if (this._parsingState.status === ParseStatus.Headers) {\n      if (!line.length) {\n        if (this.headers['content-type'] === undefined) throw new Error('Missing content type');\n        this._parsingState.status = ParseStatus.Response;\n        this._response = new MultipartResponse(this.headers['content-type']);\n      } else parseHeader(this.headers, line, ':');\n    } else if (this._parsingState.status === ParseStatus.Response) {\n      this._response.push(line);\n    }\n  }\n\n  get response(): Response {\n    if (this._parsingState) throw new Error('Attempting to use an incomplete part');\n    return this._response.response;\n  }\n}\n","// @ts-ignore\nimport Part from './PartParser.ts';\n// @ts-ignore\nimport parseHeader from './lib/parseHeader.ts';\n// @ts-ignore\nimport parseText from './lib/parseText.ts';\n\nexport enum ParseStatus {\n  Parts = 1,\n}\n\nexport interface ParsingState {\n  status: ParseStatus;\n  boundaryEnd: string | null;\n}\n\nexport default class MultipartParser {\n  type: string;\n  headers: Record<string, string> = {};\n  parts: Part[] = [];\n\n  private _parsingState: ParsingState | null = {\n    status: ParseStatus.Parts,\n    boundaryEnd: null,\n  };\n  private boundary: string | null = null;\n\n  constructor(headers: Headers | string | Record<string, string>) {\n    if (!headers) throw new Error('Headers missing');\n\n    let contentType: string;\n    if (typeof headers === 'string') contentType = headers;\n    /* c8 ignore start */ else if (headers.get) contentType = (headers as Headers).get('content-type');\n    /* c8 ignore stop */ else contentType = (headers as Record<string, string>)['content-type'];\n    if (!contentType) throw Error('content-type header not found');\n\n    const parts = contentType.split(/;/g);\n    this.type = parts.shift().trim();\n    if (this.type.indexOf('multipart') !== 0) {\n      throw new Error(`Expecting a multipart type. Received: ${contentType}`);\n    }\n\n    parts.forEach((part) => parseHeader(this.headers, part, '='));\n\n    // boundary\n    if (!this.headers.boundary) throw new Error('Invalid Content Type: no boundary');\n    this.boundary = `--${this.headers.boundary}`;\n    this._parsingState.boundaryEnd = `--${this.headers.boundary}--`;\n    this._parsingState.status = ParseStatus.Parts;\n  }\n\n  done(): boolean {\n    return !this._parsingState;\n  }\n\n  parse(text: string): MultipartParser {\n    parseText(this, text);\n    return this;\n  }\n\n  push(line: string): void {\n    const part = this.parts.length ? this.parts[this.parts.length - 1] : null;\n\n    if (!this._parsingState) throw new Error('Attempting to parse a completed multipart');\n    if (line === null) {\n      if (part && !part.done()) part.push(null);\n      this._parsingState = null;\n      return;\n    }\n\n    if (line === this._parsingState.boundaryEnd) this.push(null);\n    else if (line === this.boundary) {\n      if (part && !part.done()) part.push(null);\n      this.parts.push(new Part());\n    } else if (part) part.push(line);\n    else {\n      if (line.length) throw new Error(`Unexpected line: ${line}`);\n    }\n  }\n\n  get responses(): Response[] {\n    if (this._parsingState) throw new Error('Attempting to use an incomplete parser');\n    return this.parts.map((part) => part.response);\n  }\n}\n"],"names":["_classCallCheck","HeadersPolyfill","headers","get","key","set","value","append","delete","has","undefined","forEach","fn","getSetCookie","Error","Headers","ParsedResponse","parser","_parser","_bodyUsed","clone","text","Promise","resolve","body","json","JSON","parse","arrayBuffer","blob","formData","type","ok","status","statusText","redirected","url","bodyUsed","BodyHeaders","parseHeader","result","line","delimiter","index","indexOf","slice","trim","toLowerCase","statusLine","parseStatus","match","version","major","parseInt","minor","indexOfNewline","string","offset","includeLength","length","hasIterator","Symbol","iterator","newlineIterator","next","done","args","skip","substr","parseText","push","ParseStatus","Body","MultipartResponse","contentType","_parsingState","lines","join","response","ResponseParsed","Response","MultipartPart","_response","Parts","MultipartParser","parts","boundaryEnd","boundary","split","shift","part","Part","responses","map"],"mappings":"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"}