{"version":3,"file":"Part.js","names":["parseHeader","parseText","MultipartResponse","ParseStatus","MultipartPart","status","Headers","done","_parsingState","parse","text","push","line","Error","Response","response","length","headers","undefined"],"sources":["../../src/Part.ts"],"sourcesContent":["import parseHeader from \"./lib/parseHeader.js\";\nimport parseText from \"./lib/parseText.js\";\nimport MultipartResponse from \"./Response.js\";\nimport type { HeadersObject } from \"./index.js\";\n\nexport enum ParseStatus {\n  Headers = 1,\n  Response,\n}\n\nexport interface ParsingState {\n  status: ParseStatus;\n}\n\nexport default class MultipartPart {\n  headers: HeadersObject = {};\n  response: MultipartResponse | null;\n\n  private _parsingState: ParsingState | null = {\n    status: ParseStatus.Headers,\n  };\n\n  done(): boolean {\n    return !this._parsingState;\n  }\n\n  parse(text: string): void {\n    parseText(this, text);\n  }\n\n  push(line: string): void {\n    if (!this._parsingState) throw new Error(\"Attempting to parse a completed part\");\n    if (line === null) {\n      if (this._parsingState.status !== ParseStatus.Response) throw new Error(\"Unexpected parsing state\");\n      if (!this.response.done()) this.response.push(null);\n      this._parsingState = null;\n      return;\n    }\n\n    if (this._parsingState.status === ParseStatus.Headers) {\n      if (!line.length) {\n        if (this.headers[\"content-type\"] === undefined) throw new Error(\"Missing content type\");\n        this._parsingState.status = ParseStatus.Response;\n        this.response = new MultipartResponse(this.headers[\"content-type\"]);\n      } else parseHeader(this.headers, line, \":\");\n    } else if (this._parsingState.status === ParseStatus.Response) {\n      this.response.push(line);\n    }\n  }\n}\n"],"mappings":";;AAAA,OAAOA,WAAP,MAAwB,sBAAxB;AACA,OAAOC,SAAP,MAAsB,oBAAtB;AACA,OAAOC,iBAAP,MAA8B,eAA9B;AAGA,WAAYC,WAAZ;;WAAYA,W;EAAAA,W,CAAAA,W;EAAAA,W,CAAAA,W;GAAAA,W,KAAAA,W;;AASZ,eAAe,MAAMC,aAAN,CAAoB;EAAA;IAAA,iCACR,EADQ;;IAAA;;IAAA,uCAIY;MAC3CC,MAAM,EAAEF,WAAW,CAACG;IADuB,CAJZ;EAAA;;EAQjCC,IAAI,GAAY;IACd,OAAO,CAAC,KAAKC,aAAb;EACD;;EAEDC,KAAK,CAACC,IAAD,EAAqB;IACxBT,SAAS,CAAC,IAAD,EAAOS,IAAP,CAAT;EACD;;EAEDC,IAAI,CAACC,IAAD,EAAqB;IACvB,IAAI,CAAC,KAAKJ,aAAV,EAAyB,MAAM,IAAIK,KAAJ,CAAU,sCAAV,CAAN;;IACzB,IAAID,IAAI,KAAK,IAAb,EAAmB;MACjB,IAAI,KAAKJ,aAAL,CAAmBH,MAAnB,KAA8BF,WAAW,CAACW,QAA9C,EAAwD,MAAM,IAAID,KAAJ,CAAU,0BAAV,CAAN;MACxD,IAAI,CAAC,KAAKE,QAAL,CAAcR,IAAd,EAAL,EAA2B,KAAKQ,QAAL,CAAcJ,IAAd,CAAmB,IAAnB;MAC3B,KAAKH,aAAL,GAAqB,IAArB;MACA;IACD;;IAED,IAAI,KAAKA,aAAL,CAAmBH,MAAnB,KAA8BF,WAAW,CAACG,OAA9C,EAAuD;MACrD,IAAI,CAACM,IAAI,CAACI,MAAV,EAAkB;QAChB,IAAI,KAAKC,OAAL,CAAa,cAAb,MAAiCC,SAArC,EAAgD,MAAM,IAAIL,KAAJ,CAAU,sBAAV,CAAN;QAChD,KAAKL,aAAL,CAAmBH,MAAnB,GAA4BF,WAAW,CAACW,QAAxC;QACA,KAAKC,QAAL,GAAgB,IAAIb,iBAAJ,CAAsB,KAAKe,OAAL,CAAa,cAAb,CAAtB,CAAhB;MACD,CAJD,MAIOjB,WAAW,CAAC,KAAKiB,OAAN,EAAeL,IAAf,EAAqB,GAArB,CAAX;IACR,CAND,MAMO,IAAI,KAAKJ,aAAL,CAAmBH,MAAnB,KAA8BF,WAAW,CAACW,QAA9C,EAAwD;MAC7D,KAAKC,QAAL,CAAcJ,IAAd,CAAmBC,IAAnB;IACD;EACF;;AAlCgC"}