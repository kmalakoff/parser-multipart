{"version":3,"file":"Response.js","names":["parseHeader","parseStatus","parseText","ParseStatus","BodyHeaders","MultipartResponse","constructor","contentType","status","Body","lines","undefined","Error","headers","_parsingState","Headers","done","parse","text","push","line","body","join","length","json","JSON"],"sources":["../../src/Response.ts"],"sourcesContent":["import parseHeader from \"./lib/parseHeader.js\";\nimport parseStatus from \"./lib/parseStatus.js\";\nimport parseText from \"./lib/parseText.js\";\nimport type { Version, HeadersObject } from \"./index.js\";\n\nexport enum ParseStatus {\n  Headers = 1,\n  Body,\n}\n\nexport interface ParsingState {\n  status: ParseStatus;\n  lines: string[];\n}\n\nexport class BodyHeaders {\n  version: Version;\n  headers: HeadersObject = {};\n  ok: boolean;\n  status: number;\n  statusText: string;\n}\n\nexport default class MultipartResponse {\n  contentType: string;\n  headers: BodyHeaders = null;\n  body: string = null;\n\n  private _parsingState: ParsingState | null = {\n    status: ParseStatus.Body,\n    lines: [],\n  };\n\n  constructor(contentType: string) {\n    if (contentType === undefined) throw new Error(\"Response missing a content type\");\n    this.contentType = contentType;\n    if (this.contentType === \"application/http\") {\n      this.headers = new BodyHeaders();\n      this._parsingState.status = ParseStatus.Headers;\n    }\n  }\n\n  done(): boolean {\n    return !this._parsingState;\n  }\n\n  parse(text: string): void {\n    parseText(this, text);\n  }\n\n  push(line: string): void {\n    if (!this._parsingState) throw new Error(\"Attempting to parse a completed response\");\n    if (line === null) {\n      if (this._parsingState.status !== ParseStatus.Body) throw new Error(\"Unexpected parsing state\");\n      this.body = this._parsingState.lines.join(\"\\r\\n\");\n      this._parsingState = null;\n      return;\n    }\n\n    if (this._parsingState.status === ParseStatus.Headers) {\n      if (!line.length) this._parsingState.status = ParseStatus.Body;\n      else if (!parseStatus(this.headers, line)) parseHeader(this.headers.headers, line, \":\");\n    } else if (this._parsingState.status === ParseStatus.Body) {\n      if (!line.length) this.push(null);\n      else this._parsingState.lines.push(line);\n    }\n  }\n\n  text(): string {\n    if (this._parsingState) throw new Error(\"Attempting to use an incomplete response\");\n    return this.body;\n  }\n\n  json(): unknown {\n    if (this._parsingState) throw new Error(\"Attempting to use an incomplete response\");\n    return JSON.parse(this.body);\n  }\n}\n"],"mappings":";;AAAA,OAAOA,WAAP,MAAwB,sBAAxB;AACA,OAAOC,WAAP,MAAwB,sBAAxB;AACA,OAAOC,SAAP,MAAsB,oBAAtB;AAGA,WAAYC,WAAZ;;WAAYA,W;EAAAA,W,CAAAA,W;EAAAA,W,CAAAA,W;GAAAA,W,KAAAA,W;;AAUZ,OAAO,MAAMC,WAAN,CAAkB;EAAA;IAAA;;IAAA,iCAEE,EAFF;;IAAA;;IAAA;;IAAA;EAAA;;AAAA;AAQzB,eAAe,MAAMC,iBAAN,CAAwB;EAUrCC,WAAW,CAACC,WAAD,EAAsB;IAAA;;IAAA,iCARV,IAQU;;IAAA,8BAPlB,IAOkB;;IAAA,uCALY;MAC3CC,MAAM,EAAEL,WAAW,CAACM,IADuB;MAE3CC,KAAK,EAAE;IAFoC,CAKZ;;IAC/B,IAAIH,WAAW,KAAKI,SAApB,EAA+B,MAAM,IAAIC,KAAJ,CAAU,iCAAV,CAAN;IAC/B,KAAKL,WAAL,GAAmBA,WAAnB;;IACA,IAAI,KAAKA,WAAL,KAAqB,kBAAzB,EAA6C;MAC3C,KAAKM,OAAL,GAAe,IAAIT,WAAJ,EAAf;MACA,KAAKU,aAAL,CAAmBN,MAAnB,GAA4BL,WAAW,CAACY,OAAxC;IACD;EACF;;EAEDC,IAAI,GAAY;IACd,OAAO,CAAC,KAAKF,aAAb;EACD;;EAEDG,KAAK,CAACC,IAAD,EAAqB;IACxBhB,SAAS,CAAC,IAAD,EAAOgB,IAAP,CAAT;EACD;;EAEDC,IAAI,CAACC,IAAD,EAAqB;IACvB,IAAI,CAAC,KAAKN,aAAV,EAAyB,MAAM,IAAIF,KAAJ,CAAU,0CAAV,CAAN;;IACzB,IAAIQ,IAAI,KAAK,IAAb,EAAmB;MACjB,IAAI,KAAKN,aAAL,CAAmBN,MAAnB,KAA8BL,WAAW,CAACM,IAA9C,EAAoD,MAAM,IAAIG,KAAJ,CAAU,0BAAV,CAAN;MACpD,KAAKS,IAAL,GAAY,KAAKP,aAAL,CAAmBJ,KAAnB,CAAyBY,IAAzB,CAA8B,MAA9B,CAAZ;MACA,KAAKR,aAAL,GAAqB,IAArB;MACA;IACD;;IAED,IAAI,KAAKA,aAAL,CAAmBN,MAAnB,KAA8BL,WAAW,CAACY,OAA9C,EAAuD;MACrD,IAAI,CAACK,IAAI,CAACG,MAAV,EAAkB,KAAKT,aAAL,CAAmBN,MAAnB,GAA4BL,WAAW,CAACM,IAAxC,CAAlB,KACK,IAAI,CAACR,WAAW,CAAC,KAAKY,OAAN,EAAeO,IAAf,CAAhB,EAAsCpB,WAAW,CAAC,KAAKa,OAAL,CAAaA,OAAd,EAAuBO,IAAvB,EAA6B,GAA7B,CAAX;IAC5C,CAHD,MAGO,IAAI,KAAKN,aAAL,CAAmBN,MAAnB,KAA8BL,WAAW,CAACM,IAA9C,EAAoD;MACzD,IAAI,CAACW,IAAI,CAACG,MAAV,EAAkB,KAAKJ,IAAL,CAAU,IAAV,EAAlB,KACK,KAAKL,aAAL,CAAmBJ,KAAnB,CAAyBS,IAAzB,CAA8BC,IAA9B;IACN;EACF;;EAEDF,IAAI,GAAW;IACb,IAAI,KAAKJ,aAAT,EAAwB,MAAM,IAAIF,KAAJ,CAAU,0CAAV,CAAN;IACxB,OAAO,KAAKS,IAAZ;EACD;;EAEDG,IAAI,GAAY;IACd,IAAI,KAAKV,aAAT,EAAwB,MAAM,IAAIF,KAAJ,CAAU,0CAAV,CAAN;IACxB,OAAOa,IAAI,CAACR,KAAL,CAAW,KAAKI,IAAhB,CAAP;EACD;;AArDoC"}